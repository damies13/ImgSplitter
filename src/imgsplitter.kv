#:kivy 1.0
#:import kivy kivy
#:import win kivy.core.window



# Main box
<ImgSplitterWindow>:

	MDBoxLayout:
		padding: 1
		spacing: 3
		orientation: 'vertical'

		# menu bar
		MDBoxLayout:
			orientation: 'horizontal'
			size_hint: (1, None)
			height: 80


			MDRaisedButton:
				id: open_file
				text: 'Open File'
				on_press: root.open_file()
				valign: "top"

			Label:
				text: ""

			MDRaisedButton:
				id: spliterise
				text: 'Spliterise'
				on_press: root.split_images()
				valign: "top"

		MDBoxLayout:
			id: imgbox
			orientation: 'horizontal'
			# work area
			size_hint: (1, 9)
			valign: "top"

			FloatLayout:
				id: img_canvas
				size_hint: (1, 1)

				canvas.before:
					Color:
						rgba: 1, 1, 1, 0
				canvas:
					# id: base_canvas
					Color:
						rgb: 1, 1, 1, 0
					Rectangle:
						id: bg
						source: 'data/images/checkerboard.png'
						size: self.size
						group: "checkerboard"
					Rectangle:
						id: img
						source: root.img_src
						size: self.size
						group: "image"

				canvas.after:
					Color:
						rgba: 1, 1, 1, 0

			# config tool box
			MDBoxLayout:
				size_hint: (None, 1)
				width: 380
				orientation: 'vertical'

				# header row
				MDBoxLayout:
					size_hint: (1, 0.5)
					orientation: 'horizontal'
					MDLabel:
						text: "(image pixels)"
						halign: "center"
						valign: 'middle'
						text_size: self.size
				# sub header row
				MDBoxLayout:
					size_hint: (1, 0.5)
					orientation: 'horizontal'
					MDLabel:
						text: "Offset"
						halign: "left"
						valign: 'middle'
						text_size: self.size
				# spacer row
				MDBoxLayout:
					size_hint: (1, 0.5)
					orientation: 'horizontal'
					MDLabel:
						text: ""
				MDBoxLayout:
					size_hint: (1, 0.5)
					orientation: 'horizontal'
					MDLabel:
						text: ""
					MDTextField:
						id: offset_left
						halign: "center"
						multiline: False
						input_filter: 'int'
						text: app.config.get(app.config.get('ImgSplitter', 'seleted_template'), 'offset_left')
						hint_text: "Left"
						on_text_validate: root.set_subimg_left(offset_left)
						on_touch_move: root.set_subimg_left(offset_left)
						on_touch_up: root.set_subimg_left(offset_left)
					MDLabel:
						text: ""
					MDTextField:
						id: offset_top
						halign: "center"
						multiline: False
						input_filter: 'int'
						text: app.config.get(app.config.get('ImgSplitter', 'seleted_template'), 'offset_top')
						hint_text: "Top"
						# mode: "rectangle"
						on_text_validate: root.set_subimg_top(offset_top)
						on_touch_move: root.set_subimg_top(offset_top)
						on_touch_up: root.set_subimg_top(offset_top)
					MDLabel:
						text: ""
				# sub header row
				MDBoxLayout:
					size_hint: (1, 0.5)
					orientation: 'horizontal'
					MDLabel:
						text: "Seperation"
						halign: "left"
						valign: 'middle'
						text_size: self.size
				# spacer row
				MDBoxLayout:
					size_hint: (1, 0.5)
					orientation: 'horizontal'
					MDLabel:
						text: ""
				MDBoxLayout:
					size_hint: (1, 0.5)
					orientation: 'horizontal'
					MDLabel:
						text: ""
					MDTextField:
						id: offset_vert
						halign: "center"
						multiline: False
						input_filter: 'int'
						text: app.config.get(app.config.get('ImgSplitter', 'seleted_template'), 'seperation_vertical')
						hint_text: "Verical"
						on_text_validate: root.set_subimg_vert(offset_vert)
						on_touch_move: root.set_subimg_vert(offset_vert)
						on_touch_up: root.set_subimg_vert(offset_vert)
					MDLabel:
						text: ""
					MDTextField:
						id: offset_horz
						halign: "center"
						multiline: False
						input_filter: 'int'
						text: app.config.get(app.config.get('ImgSplitter', 'seleted_template'), 'seperation_horizontal')
						hint_text: "Horizontal"
						on_text_validate: root.set_subimg_horz(offset_horz)
						on_touch_move: root.set_subimg_horz(offset_horz)
						on_touch_up: root.set_subimg_horz(offset_horz)
					MDLabel:
						text: ""
				# sub header row
				MDBoxLayout:
					size_hint: (1, 0.5)
					orientation: 'horizontal'
					MDLabel:
						text: "Sub Image"
						halign: "left"
						valign: 'middle'
						text_size: self.size
				# spacer row
				MDBoxLayout:
					size_hint: (1, 0.5)
					orientation: 'horizontal'
					MDLabel:
						text: ""
				MDBoxLayout:
					size_hint: (1, 0.5)
					orientation: 'horizontal'
					MDLabel:
						text: ""
					MDTextField:
						id: size_width
						halign: "center"
						multiline: False
						input_filter: 'int'
						text: app.config.get(app.config.get('ImgSplitter', 'seleted_template'), 'subimage_width')
						hint_text: "Width"
						on_text_validate: root.set_subimg_width(size_width)
						on_touch_move: root.set_subimg_width(size_width)
						on_touch_up: root.set_subimg_width(size_width)
					MDLabel:
						text: ""
					MDTextField:
						id: size_height
						halign: "center"
						multiline: False
						input_filter: 'int'
						text: app.config.get(app.config.get('ImgSplitter', 'seleted_template'), 'subimage_height')
						hint_text: "Height"
						on_text_validate: root.set_subimg_height(size_height)
						on_touch_move: root.set_subimg_height(size_height)
						on_touch_up: root.set_subimg_height(size_height)
					MDLabel:
						text: ""
				# sub header row
				MDBoxLayout:
					size_hint: (1, 0.5)
					orientation: 'horizontal'
					MDLabel:
						text: "Grid"
						halign: "left"
						valign: 'middle'
						text_size: self.size
				# spacer row
				MDBoxLayout:
					size_hint: (1, 0.5)
					orientation: 'horizontal'
					MDLabel:
						text: ""
				MDBoxLayout:
					size_hint: (1, 0.5)
					orientation: 'horizontal'
					Label:
						text: ""
					MDTextField:
						id: count_cols
						halign: "center"
						multiline: False
						input_filter: 'int'
						text: app.config.get(app.config.get('ImgSplitter', 'seleted_template'), 'grid_columns')
						hint_text: "Columns"
						on_text_validate: root.set_subimg_cols(count_cols)
						on_touch_move: root.set_subimg_cols(count_cols)
						on_touch_up: root.set_subimg_cols(count_cols)
					MDLabel:
						text: ""
					MDTextField:
						id: count_rows
						halign: "center"
						multiline: False
						input_filter: 'int'
						text: app.config.get(app.config.get('ImgSplitter', 'seleted_template'), 'grid_rows')
						hint_text: "Rows"
						on_text_validate: root.set_subimg_rows(count_rows)
						on_touch_move: root.set_subimg_rows(count_rows)
						on_touch_up: root.set_subimg_rows(count_rows)
					MDLabel:
						text: ""
				# Block space row
				MDBoxLayout:
					size_hint: (1, 5)
					orientation: 'horizontal'
					MDLabel:
						text: ""
				MDBoxLayout:
					size_hint: (1, 0.5)
					orientation: 'horizontal'
					MDLabel:
						text: root.version_display
						halign: "center"


		# # status bar
		# MDBoxLayout:
		# 	orientation: 'horizontal'
		# 	# size_hint: (1, .05)
		# 	size_hint: (1, 1)
		# 	valign: "bottom"
		# 	halign: "left"
		#
		# 	MDLabel:
		# 		id: status_bar
		# 		# size_hint: (5, 0.05)
		# 		text: root.status_bar
		# 		valign: "bottom"
		# 		halign: "left"



<Custom@Switch>:
	values: ['OFF', 'ON']
	canvas:
		Color:
			rgb: 0.2, 0.709, 0.898, 1
		Rectangle:
			size: [sp(41.5), sp(20)]
			pos: [self.center_x - sp(41.5), self.center_y - sp(10)]
		Color:
			rgb: 0.4, 0.4, 0.4, 1
		Rectangle:
			size: [sp(41.5), sp(20)]
			pos: [self.center_x, self.center_y - sp(10)]
	MDLabel:
		text: '[b]{}[/b]'.format(root.values[0])
		markup: True
		font_size: 13
		pos: [root.center_x - sp(70), root.center_y - sp(50)]
	MDLabel:
		color: 0.75, 0.75, 0.75, 1
		text: '[b]{}[/b]'.format(root.values[1])
		markup: True
		font_size: 13
		pos: [root.center_x - sp(30), root.center_y - sp(50)]


<LoadDialog>:
	MDBoxLayout:
		size: root.size
		pos: root.pos
		orientation: "vertical"
		FileChooserListView:
		# MDFileManager:
			id: filechooser
			path: "."

		MDBoxLayout:
			size_hint_y: None
			height: 30
			MDRaisedButton:
				id: test
				text: "Cancel"
				on_release: root.cancel()

			MDLabel:
				text: ""

			MDRaisedButton:
				text: "Load"
				on_release: root.load(filechooser.path, filechooser.selection)
